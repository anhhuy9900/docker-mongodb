version: "3.8"
services:
    mongodb:
        #build: /Volumes/HUY/projects/docker/mongodb
        image: mongo
        container_name: mongodb
        hostname: mongodb
        environment:
            #- PUID=1000
            #- PGID=1000
            MONGO_INITDB_ROOT_USERNAME: ${MONGO_INITDB_ROOT_USERNAME:-admin}
            MONGO_INITDB_ROOT_PASSWORD: ${MONGO_INITDB_ROOT_PASSWORD:-admin}
            MONGO_INITDB_DATABASE: ${MONGO_INITDB_DATABASE:-test}
            MONGO_REPLICA_SET_NAME: ${MONGO_REPLICA_SET_NAME:-rs0}
        volumes:
            - ./databases:/data/db
            - ./mongod.conf:/etc/mongod.conf
            - ./initdb.d/:/docker-entrypoint-initdb.d/
            - ./databases/:/data/db/
            - ./log:/var/log/mongodb/
        expose:
            - 27017
        ports:
            - 27017:27017
        healthcheck:
            test: test $$(echo "rs.initiate().ok || rs.status().ok" | mongo --quiet) -eq 1
            interval: 10s
            start_period: 30s
        entrypoint: ["/usr/bin/mongod", "--replSet", "rs0", "--bind_ip_all"]
        restart: always